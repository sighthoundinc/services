# Sighthound docker-compose service


## Quick start

### Available services

#### mcp (Media Control Point)

MCP is a service listening for output fron the SIO analytics container, and providing indexing, time-based access and cleanup services for any media generated by it.

Please keep in mind, that keeping MCP configuration mounted volumes, and `recordTo`/`imageSaveDir` parameters of the SIO pipleine configuration in sync  (i.e. as shipped) is vital to keeping things operational.

If MCP service is disabled and SIO generates media, user MUST provide a cleanup service of their own.
#### sio

SIO is the analytics engine processing the live video feed(s), or provided images, and emitting analytics on the AMQP bus. It also optionally persists images and video from the source.
#### rabbitmq

AMQP broker. If the device operates in a standalone mode, must be enabled. If external AMQP broker is used, SIO and MCP configuration must be adjusted
#### core

Core sighthound service that creates the `core_sighthound` docker network.
### Configuration

First create the data dirs
1. `mkdir -p /data/sighthound`
2. `mkdir -p /data/sighthound/media`
3. `mkdir -p /data/sighthound/services`
4. `mkdir -p /data/sighthound/license`
5. Install SIO license in `/data/sighthound/license/sighthound-license.json`
6. Uncompress services tarball into `/data/sighthound/services`
7. Modify the `sio.json` file corresponding your sio selected configuration. (Setting the right URL, pipeline parameters...)


#### SIO pipeline parameters

SIO configuration must be provided in ./sio/conf/sio.json.
This configuration file specifies analytics pipeline(s) to be ran,
and parameters to be passed to each of those.

Some useful pipeline parameters:

```
VIDEO_IN: the RTSP URL to use
fpsLimit: limits the fps intake by the analytis pipeline
```

The following parameters should be kept as is, or set to empty to disable the generation of recorded videeo/images.
```
recordTo: Path for video storage. Should be: /data/sighthound/media/output/video/${sourceId}/
imageSaveDir: Path for image storage. Should be: /data/sighthound/media/output/image/${sourceId}/
```

For more advanced options visit [VehicleAnalytics Documentation](https://dev.sighthound.com/sio/pipelines/VehicleAnalytics/) and [TrafficAnalytics Documentation](https://dev.sighthound.com/sio/pipelines/TrafficAnalytics/)

### Deployment

1. `cd core && docker-compose up -d --env-file=conf/default.env ; cd -`
2. `cd rabbitmq && docker-compose up -d --env-file=conf/default.env ; cd -`
3. `cd mcp && docker-compose up -d --env-file=conf/default.env ; cd -`


At this point you can test your deployment by going to:

http://localhost:18672 and http://localhost:8089
